#include "colores.ch"
CLEAR
SET COLOR TO COLOR3
@1,0 SAY 'ESTACION DE SERVICIO CENTRO'

numero=LEFT(DTOC(DATE()),2)
DIA=TDIAS(cdow(DATE()))
MES=TMES(CMONTH(DATE()))
ANIO=ALLTRIM(STR(YEAR(DATE())))
VFECHA=DIA+' '+numero+' de '+MES+' de '+ANIO
LL=79-LEN(VFECHA)

SET COLOR TO COLOR0
@1,LL SAY VFECHA
@2,0 SAY REPLICATE('Ä',27)
@2,LL SAY REPLICATE('Ä',LEN(VFECHA))
@0,32 TO 2,41

SET COLOR TO COLOR9
@1,35 SAY 'CAJA'
SET COLOR TO COLOR3
@3,0 SAY 'RECUENTO DEL DINERO'
SET COLOR TO COLOR0
LAROPER=LEN(ALLTRIM(NOMBOPER))
LAOP=LAROPER+19
@3,79-LAOP SAY 'Operador de turno:'
SET COLOR TO COLOR3
@3,79-LAOP+19 SAY NOMBOPER
SET COLOR TO COLOR0

USE VENTAS
INDEX ON NUMEROCAJA TO ORDCAJA
GO BOTTOM

IF NUMEROCAJA<>NUMACT
   TONE(500,2)
   SET COLOR TO COLOR4
   @13,21 TO 15,55
   @14,22 CLEAR TO 14,54
   SET COLOR TO COLOR8
   @14,23 SAY 'NO EXISTEN VENTAS EN ESTE TURNO'
   SET COLOR TO COLOR0
   INKEY(5)
   CLOSE
   RETURN
ENDIF

SAVE SCREEN TO ANITA

DO WHILE .T.
   STORE 0 TO VB100,VB50,VB20,VB10,VB5,VB2,VM1,VM50,VM25,VM10,VM5
   SET COLOR TO COLOR0
   @4,0 SAY REPLICATE('Ä',80)
   SET CURSOR ON
   @5,2 SAY 'Billetes de  $ 100 :'GET VB100 PICTURE '99999'
   @5,52 SAY 'Billetes de  $  50 :'GET VB50 PICTURE '99999'
   @6,0 SAY REPLICATE('Ä',80)
   @7,2 SAY 'Billetes de  $  20 :'GET VB20 PICTURE '99999'
   @7,52 SAY 'Billetes de  $  10 :'GET VB10 PICTURE '99999'
   @8,0 SAY REPLICATE('Ä',80)
   @9,2 SAY 'Billetes de  $   5 :'GET VB5 PICTURE '99999'
   @9,52 SAY 'Billetes de  $   2 :'GET VB2 PICTURE '99999'
   @10,0 SAY REPLICATE('Ä',80)
   @11,2 SAY 'Monedas  de  $   1 :'GET VM1 PICTURE '99999'
   @11,52 SAY 'Monedas  de 50 cvos:'GET VM50 PICTURE '99999'
   @12,0 SAY REPLICATE('Ä',80)
   @13,2 SAY 'Monedas  de 25 cvos:'GET VM25 PICTURE '99999'
   @13,52 SAY 'Monedas  de 10 cvos:'GET VM10 PICTURE '99999'
   @14,0 SAY REPLICATE('Ä',80)
   @15,2 SAY 'Monedas  de  5 cvos:'GET VM5 PICTURE '99999'
   @16,0 SAY REPLICATE('Ä',80)
   READ

   IF LASTKEY()=27
      RETURN
   ENDIF

   @20,26 SAY '¨ Est  todo correcto (S/N) ?'
   SET COLOR TO COLOR3
   @20,48 SAY 'S'
   @20,50 SAY 'N'
   SET COLOR TO COLOR0
   SET CURSOR OFF

   DO WHILE .T.
      INKEY(0)
      IF LASTKEY()<>83.AND.LASTKEY()<>115.AND.LASTKEY()<>78.AND.LASTKEY()<>110
         TONE(1200,1)
         LOOP
      ENDIF
      EXIT
   ENDDO

   @20,0

   IF LASTKEY()=78.OR.LASTKEY()=110
      LOOP
   ENDIF

   TB=(VB100*100)+(VB50*50)+(VB20*20)+(VB10*10)+(VB5*5)+(VB2*2)
   TM=(VM1*1)+(VM50*0.50)+(VM25*0.25)+(VM10*0.10)+(VM5*0.05)
   TEXISTE=TB+TM

   USE GASTOS
   GO TOP
   SUM VALOR TO TGASTOS FOR NUMEROCAJA=NUMACT

   USE VENTAS
   GO TOP
   SUM SUBTOTAL TO TVENTAS FOR NUMEROCAJA=NUMACT

   USE BASECAJA
   INDEX ON NUMEROCAJA TO ORDCAJA
   GO BOTTOM
   STORE ENCAJA TO SALDOCAJA
   STORE OPERADOR TO OPERANTERIOR
   X1=LEN(ALLTRIM(OPERANTERIOR))

   SET COLOR TO COLOR0
   @17,0 SAY '$ dejado por '
   @17,14+X1 SAY 'en turno anterior '
   @17,31+X1 SAY REPLICATE('.',33-X1)
   @17,64 SAY '$ '
   SET COLOR TO COLOR3
   @17,13 SAY ALLTRIM(OPERANTERIOR)
   @17,66 SAY SALDOCAJA PICTURE '9999.999'
   SET COLOR TO COLOR0
   @18,0 SAY '+ Total de ventas...............................................$'
   SET COLOR TO COLOR3
   @18,66 SAY TVENTAS PICTURE '9999.999'
   SET COLOR TO COLOR0
   @19,0 SAY '- Total de gastos varios........................................$'
   SET COLOR TO COLOR3
   @19,66 SAY TGASTOS PICTURE '9999.999'
   SET COLOR TO COLOR0
   @20,65 SAY REPLICATE('-',9)
   @21,25 SAY 'Dinero que deber¡a haber en caja.......$'
   TDEBERIA=SALDOCAJA+TVENTAS-TGASTOS
   SET COLOR TO COLOR3
   @21,66 SAY TDEBERIA PICTURE '9999.999'
   SET COLOR TO COLOR0
   @23,0 SAY 'Dinero existente en caja........................................$'
   SET COLOR TO COLOR3
   @23,66 SAY TEXISTE PICTURE '9999.999'
   SET COLOR TO COLOR0
   @24,29 SAY '¨ Realiza Caja (S/N) ?'
   SET COLOR TO COLOR3
   @24,45 SAY 'S'
   @24,47 SAY 'N'
   SET COLOR TO COLOR0
   SET CURSOR OFF

   DO WHILE .T.
      INKEY(0)
      IF LASTKEY()<>83.AND.LASTKEY()<>115.AND.LASTKEY()<>78.AND.LASTKEY()<>110
         TONE(1200,1)
         LOOP
      ENDIF
      EXIT
   ENDDO

   @24,0

   IF LASTKEY()=83.OR.LASTKEY()=115
      APPEND BLANK
      REPLACE FECHA WITH DATE(),HORA WITH TIME(),PASWORD WITH CLOP
      REPLACE OPERADOR WITH NOMBOPER,TOTVENTAS WITH TVENTAS,TOTGASTOS WITH TGASTOS
      REPLACE ENCAJA WITH TEXISTE,DEBERIA WITH TDEBERIA,NUMEROCAJA WITH NUMACT

      USE ACTUAL
      GO TOP
      REPLACE HIZOCAJA WITH 'S'

      EXIT
   ENDIF

   RESTORE SCREEN FROM ANITA
   LOOP
ENDDO
RETURN
